# Mouseion アーキテクチャ

## 概要

Mouseionは、関心事を分離しながらコンポーネント間のシームレスな統合を可能にする3層アーキテクチャとして設計されています。

## システムレイヤー

```
┌─────────────────────────────────────────────────────────────────┐
│                    アプリケーション層                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │ウォレット│  │  データ  │  │   報酬   │  │マーケット│        │
│  │   UI     │  │  登録    │  │ダッシュ  │  │プレイス  │        │
│  │          │  │          │  │ボード    │  │          │        │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘        │
│  ┌──────────┐  ┌──────────┐                                     │
│  │ガバナンス│  │  専門家  │                                     │
│  │  投票    │  │ポータル  │                                     │
│  └──────────┘  └──────────┘                                     │
├─────────────────────────────────────────────────────────────────┤
│                      サービス層                                  │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐    │
│  │    貢献追跡    │  │    報酬分配    │  │  ガバナンス    │    │
│  │                │  │                │  │   エンジン     │    │
│  └────────────────┘  └────────────────┘  └────────────────┘    │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐    │
│  │  データ管理    │  │   専門家選定   │  │ バージョン     │    │
│  │                │  │                │  │   管理         │    │
│  └────────────────┘  └────────────────┘  └────────────────┘    │
├─────────────────────────────────────────────────────────────────┤
│                      レイヤー1（基盤）                           │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │         可逆送金型ブロックチェーン（Julia）                │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  │  │
│  │  │ 保留型   │  │   取消   │  │ガーディ  │  │ワンタイム│  │  │
│  │  │ 送金     │  │ ロジック │  │アン承認  │  │   鍵     │  │  │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## レイヤー1: 可逆送金型ブロックチェーン

### 目的
基盤層は、組み込みのトランザクション可逆性を持つ新しいブロックチェーンを提供し、安全で回復可能な金融操作を可能にします。

### 主要コンポーネント

#### 保留型送金エンジン
- トランザクションは確認されるまで保留状態を維持
- 設定可能な保留期間（3分〜24時間）
- タイムアウトルールに基づく自動確定または返金

#### 取消ロジック
- 受取人が確認する前に送信者がキャンセル可能
- 悪用防止のための小額のキャンセル手数料
- キャンセル試行のレート制限

#### ガーディアンシステム
- 紛争解決のためのマルチシグ承認
- 詐欺ケースに対する凍結・回復機能
- ステーキングによる分散型ガーディアン選出

#### ワンタイム鍵（合言葉）システム
- トランザクションごとに固有の合言葉を生成
- 受取人は一致する確認を返す必要がある
- 誤送金となりすましを防止

### 技術
- **言語**: Julia
- **コンセンサス**: 未定（PoS系を想定）
- **ブロック時間**: 5秒以下を目標

## サービス層: AI印税分配

### 貢献追跡モジュール

```
┌─────────────────────────────────────────┐
│            貢献追跡エンジン             │
├─────────────────────────────────────────┤
│  入力分析                               │
│  ├── 意味的類似度（BERT）               │
│  ├── キーワードマッチング（TF-IDF）     │
│  └── パターン認識（クラスタリング）     │
├─────────────────────────────────────────┤
│  帰属エンジン                           │
│  ├── RAGベース参照追跡                  │
│  ├── Attention Weight解析              │
│  └── Influence Function推定            │
├─────────────────────────────────────────┤
│  貢献スコア計算                         │
│  ├── 利用頻度                           │
│  ├── 品質スコア                         │
│  ├── 類似度スコア                       │
│  └── 希少性係数                         │
└─────────────────────────────────────────┘
```

### 報酬分配モジュール

```
┌─────────────────────────────────────────┐
│            報酬分配エンジン             │
├─────────────────────────────────────────┤
│  プール管理                             │
│  ├── 手数料徴収                         │
│  ├── トークン割当                       │
│  └── リザーブ管理                       │
├─────────────────────────────────────────┤
│  分配エンジン                           │
│  ├── 貢献集計                           │
│  ├── 按分計算                           │
│  └── 保留型送金実行                     │
├─────────────────────────────────────────┤
│  検証                                   │
│  ├── 二重支払い防止                     │
│  ├── 不正検知                           │
│  └── 監査証跡                           │
└─────────────────────────────────────────┘
```

### データ管理モジュール

```
┌─────────────────────────────────────────┐
│            データマネージャー           │
├─────────────────────────────────────────┤
│  登録                                   │
│  ├── メタデータ検証                     │
│  ├── ハッシュ生成                       │
│  └── 権限記録                           │
├─────────────────────────────────────────┤
│  ストレージ連携                         │
│  ├── オンチェーン（メタデータ）         │
│  └── オフチェーン（IPFS/Arweave）       │
├─────────────────────────────────────────┤
│  人間/AI分離                            │
│  ├── ソースタグ付け                     │
│  ├── 分離インデックス                   │
│  └── 学習フィルター                     │
└─────────────────────────────────────────┘
```

### 専門家選定モジュール

```
┌─────────────────────────────────────────┐
│            専門家セレクター             │
├─────────────────────────────────────────┤
│  審査区分表                             │
│  ├── 学術分野                           │
│  ├── 産業セクター                       │
│  └── 専門タグ                           │
├─────────────────────────────────────────┤
│  候補者スコアリング                     │
│  ├── 過去の貢献                         │
│  ├── 評価履歴                           │
│  └── 専門性スコア                       │
├─────────────────────────────────────────┤
│  選定アルゴリズム                       │
│  ├── AIベースマッチング                 │
│  └── コミュニティ投票                   │
└─────────────────────────────────────────┘
```

### アノテーション・相互レビューシステム

このセクションでは、データ提出から品質保証されたアノテーション完了までの完全なワークフローを詳述します。

#### システム概要

```
┌─────────────────────────────────────────────────────────────────────┐
│              アノテーション・相互レビューシステム                    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐             │
│  │  審査区分表  │    │   専門家    │    │   専門家    │             │
│  │  レジストリ │───►│  マッチング │───►│  割当キュー │             │
│  │             │    │   エンジン   │    │             │             │
│  └─────────────┘    └─────────────┘    └──────┬──────┘             │
│                                               │                     │
│                                               ▼                     │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐             │
│  │   品質      │◄───│   相互      │◄───│ アノテーション│            │
│  │  スコア     │    │  レビュー   │    │ ワークスペース│            │
│  │   計算      │    │  エンジン   │    │              │             │
│  └──────┬──────┘    └─────────────┘    └─────────────┘             │
│         │                                                           │
│         ▼                                                           │
│  ┌─────────────┐    ┌─────────────┐                                │
│  │レピュテーション│───►│   報酬     │                                │
│  │  トラッカー  │    │   分配     │                                │
│  └─────────────┘    └─────────────┘                                │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 完全なアノテーションワークフロー

```
┌────────────────────────────────────────────────────────────────────┐
│                   アノテーションワークフロー                        │
└────────────────────────────────────────────────────────────────────┘

1. リクエストフェーズ
   ┌──────────┐     ┌──────────────┐     ┌──────────────┐
   │  データ   │────►│   分野別     │────►│  リクエスト  │
   │   提出   │     │   分類       │     │    作成      │
   └──────────┘     └──────────────┘     └──────┬───────┘
                                                │
2. マッチングフェーズ                            ▼
   ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
   │   審査区分表  │────►│   候補者     │────►│   上位N名    │
   │    照会     │     │  スコアリング │     │    選定      │
   └──────────────┘     └──────────────┘     └──────┬───────┘
                                                    │
3. アノテーションフェーズ                           ▼
   ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
   │   専門家に   │────►│   専門家が   │────►│ アノテーション│
   │    通知     │     │  アノテート  │     │    提出      │
   └──────────────┘     └──────────────┘     └──────┬───────┘
                                                    │
4. 相互レビューフェーズ                             ▼
   ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
   │  レビュアー  │────►│    相互      │────►│   一致度     │
   │    割当     │     │   レビュー   │     │    計算      │
   └──────────────┘     └──────────────┘     └──────┬───────┘
                                                    │
5. 確定フェーズ                                     ▼
   ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
   │    品質      │────►│レピュテーション│────►│    報酬      │
   │  スコア計算  │     │    更新       │     │    分配      │
   └──────────────┘     └──────────────┘     └──────────────┘
```

#### 相互レビューメカニズム

```
┌─────────────────────────────────────────┐
│          相互レビューエンジン           │
├─────────────────────────────────────────┤
│  レビュー割当                           │
│  ├── 2〜3名のピアレビュアーを選定       │
│  ├── 元のアノテーターとは別の人物       │
│  └── 同等の専門性レベル                 │
├─────────────────────────────────────────┤
│  レビュー基準                           │
│  ├── 正確性 (0-100)                     │
│  ├── 完全性 (0-100)                     │
│  ├── 一貫性 (0-100)                     │
│  └── 適時性（期限遵守）                 │
├─────────────────────────────────────────┤
│  コンセンサス計算                       │
│  ├── 一致率                             │
│  ├── 加重平均スコア                     │
│  └── 外れ値検出                         │
├─────────────────────────────────────────┤
│  紛争解決                               │
│  ├── 不一致時は第三のレビュアー         │
│  ├── 必要に応じてガーディアンへ         │
│  └── 最終仲裁プロセス                   │
└─────────────────────────────────────────┘
```

#### 品質スコア計算

```
品質スコア = (
    正確性 × 0.35 +
    完全性 × 0.25 +
    一貫性 × 0.25 +
    適時性 × 0.15
) × 一致度修正係数

一致度修正係数:
  - 高一致 (>90%): 1.0
  - 中一致 (70-90%): 0.9
  - 低一致 (<70%): 0.7 + 再レビュー必要
```

#### 専門家レピュテーションシステム

```
┌─────────────────────────────────────────┐
│       レピュテーショントラッカー        │
├─────────────────────────────────────────┤
│  追跡メトリクス                         │
│  ├── 累計アノテーション数               │
│  ├── 平均品質スコア                     │
│  ├── ピアレビュー精度                   │
│  ├── 平均応答時間                       │
│  └── 紛争率                             │
├─────────────────────────────────────────┤
│  レピュテーションスコア計算式           │
│  │                                      │
│  │  Rep = (平均品質 × 0.4) +            │
│  │        (レビュー精度 × 0.3) +        │
│  │        (信頼性 × 0.2) +              │
│  │        (経験値 × 0.1)                │
│  │                                      │
├─────────────────────────────────────────┤
│  レピュテーションの効果                 │
│  ├── マッチングでの優先度向上           │
│  ├── 報酬倍率の向上                     │
│  ├── 複雑なタスクへの適格性             │
│  └── ガバナンス重み付けボーナス         │
└─────────────────────────────────────────┘
```

#### 審査区分表の管理

```
┌─────────────────────────────────────────┐
│        審査区分表レジストリ             │
├─────────────────────────────────────────┤
│  構造                                   │
│  ├── レベル1: 主要分野 (CS, MED...)     │
│  ├── レベル2: サブフィールド            │
│  ├── レベル3: 専門特化                  │
│  └── タグ: 分野横断スキル               │
├─────────────────────────────────────────┤
│  ガバナンス                             │
│  ├── 新分野のコミュニティ提案           │
│  ├── 構造変更の投票                     │
│  ├── 専門家委員会レビュー               │
│  └── テーブルのバージョン管理           │
├─────────────────────────────────────────┤
│  専門家登録                             │
│  ├── 自己申告による専門性               │
│  ├── 資格認証（オプション）             │
│  ├── 検証用テストアノテーション         │
│  └── コミュニティ推薦                   │
└─────────────────────────────────────────┘
```

### ガバナンスモジュール

```
┌─────────────────────────────────────────┐
│          ガバナンスエンジン             │
├─────────────────────────────────────────┤
│  提案管理                               │
│  ├── 提出                               │
│  ├── 議論期間                           │
│  └── 投票期間                           │
├─────────────────────────────────────────┤
│  投票メカニズム                         │
│  ├── 単純多数決                         │
│  ├── 二次投票                           │
│  └── 委任投票                           │
├─────────────────────────────────────────┤
│  実行                                   │
│  ├── パラメータ更新                     │
│  ├── システムアップグレード             │
│  └── 資産管理                           │
└─────────────────────────────────────────┘
```

## アプリケーション層

### ウォレットUI
- トークン管理
- トランザクション履歴
- 保留型送金の確認
- ワンタイム鍵の生成/確認

### データ登録
- データアップロードとメタデータ入力
- 権限設定（オプトイン/オプトアウト）
- 利用状況ダッシュボード

### 報酬ダッシュボード
- 収益の可視化
- 貢献内訳
- 支払い履歴

### ガバナンス投票
- 提案の閲覧
- 投票インターフェース
- 委任管理

### 専門家ポータル
- アノテーション作業スペース
- ピアレビューインターフェース
- 専門性プロファイル管理

### マーケットプレイス
- データ検索
- ライセンス購入
- 直接販売

## データフロー

### データ登録フロー
```
ユーザー → データ登録UI → データマネージャー → オンチェーン（メタデータ）+ オフチェーン（本体）
```

### AI生成フロー
```
AIサービス → 貢献追跡 → 帰属 → 報酬分配 → 保留型送金
```

### 報酬請求フロー
```
貢献者 → ウォレットUI → 受領確認 → レイヤー1（確定） → トークン移転
```

### ガバナンスフロー
```
提案 → 議論 → 投票 → 実行（可決時）
```

## 外部連携

### オフチェーンストレージ
- **IPFS**: 分散ファイルストレージ
- **Arweave**: 永続ストレージオプション

### AIサービス
- 貢献追跡用API連携
- 報酬トリガー用Webhook通知

### 本人確認（オプション）
- 高額操作向けKYCプロバイダー
- ソーシャルリカバリーサービス

## セキュリティ考慮事項

### レイヤー1
- アトミックな状態遷移
- ワンタイム鍵用の暗号学的乱数
- キャンセルのレート制限

### サービス層
- 不正検知アルゴリズム
- 相互レビュー検証
- 監査ログ

### アプリケーション層
- セキュアな鍵保管
- フィッシング保護
- ドメイン検証

## スケーラビリティパス

### Phase 1: シングルノード（MVP）
- 基本的な台帳機能
- シンプルなWebウォレット

### Phase 2: マルチノード
- 分散コンセンサス
- 同期プロトコル

### Phase 3: レイヤー2（将来）
- バッチ処理
- オフチェーン計算
- ステートチャネル
